function varargout = scroll_panel(varargin)

myhandles.number_of_markers=1;
setappdata(0,'myhandles',myhandles);    

handles.background_color='black';
handles.foreground_color='white';

handles.gui_width=1000;
handles.gui_height=700;

handles.left_edge_of_panel=0.05;
handles.width_of_panel=0.6;
handles.right_edge_of_panel=handles.left_edge_of_panel+handles.width_of_panel;
handles.bottom_of_panel=0.25;
handles.height_of_panel=0.55;
handles.top_of_panel=handles.bottom_of_panel+handles.height_of_panel;

handles.marker_panel_height=0.2; %As fraction of gui height

handles.fig=figure('position',[0,0,handles.gui_width,handles.gui_height],'Color',handles.background_color,...
'MenuBar','none');



handles.main_panel=uipanel('BackgroundColor',handles.background_color,...
'position',[handles.left_edge_of_panel,0.05,handles.width_of_panel,1.5],'ForegroundColor',handles.foreground_color,...
'parent',handles.fig,'BorderType','none');
uistack(handles.main_panel,'bottom');

handles.top_blocking_frame=uicontrol('Style','frame','Units','normalized','BackgroundColor',handles.background_color,...
'position',[handles.left_edge_of_panel,handles.top_of_panel,handles.width_of_panel,1-handles.top_of_panel],'ForegroundColor',...
handles.background_color,'parent',handles.fig);
uistack(handles.top_blocking_frame,'top');
handles.bottom_blocking_frame=uicontrol('Style','frame','Units','normalized','BackgroundColor',handles.background_color,...
'position',[handles.left_edge_of_panel,0.0,handles.width_of_panel,handles.bottom_of_panel],'ForegroundColor',...
handles.background_color,'parent',handles.fig);
uistack(handles.bottom_blocking_frame,'top');
%handles.child_panel=uipanel('Title','Child Panel','BackgroundColor',handles.background_color,...
%'position',[0.1,0.4,0.8,0.2],'ForegroundColor',handles.foreground_color,'parent',handles.main_panel);

handles.scroll_bar=uicontrol('Style', 'slider',...
        'Min',0,'Max',1,'Value',1,'Units','normalized',...
        'position', [handles.right_edge_of_panel+0.05,handles.bottom_of_panel,0.02,handles.height_of_panel],...
        'Callback', {@scroll_callback,handles},'parent',handles.fig);

handles.add_marker=uicontrol('Style', 'pushbutton',...
        'Units','normalized','String','Add marker',...
        'position', [handles.left_edge_of_panel+0.05,handles.bottom_of_panel-0.15,0.1,0.05],...
        'Callback', {@addmarker_callback,handles},'parent',handles.fig);

handles.marker_handles(myhandles.number_of_markers)=add_marker(600-150*myhandles.number_of_markers,handles.main_panel,handles);
uistack(handles.main_panel,'bottom');


%set(handles.fig,'children',[handles.top_blocking_panel,handles.bottom_blocking_panel,handles.scroll_bar,handles.add_marker,handles.main_panel]);
setappdata(0,'handles',handles);        
setappdata(0,'myhandles',myhandles);    



function scroll_callback(hObject,eventdata,handles)
set(handles.main_panel,'position',[0.05,1-get(hObject,'Value'),0.6,0.9]);
setappdata(0,'handles',handles);   

function addmarker_callback(hObject,eventdata,handles)
myhandles=getappdata(0,'myhandles');  
myhandles.number_of_markers=myhandles.number_of_markers+1;
setappdata(0,'myhandles',myhandles);
handles.marker_handles(myhandles.number_of_markers)=add_marker(600-150*myhandles.number_of_markers,handles.main_panel,handles);
setappdata(0,'handles',handles);   
setappdata(0,'myhandles',myhandles);


function marker_handles=add_marker(height,parent_handle,handles)
%panel_dims = get(parent_handle,'position')              % Get the axis limits [xlim ylim (zlim)]
panel_width=handles.width_of_panel*handles.gui_width;
panel_height=handles.height_of_panel*handles.gui_height;
myhandles=getappdata(0,'myhandles');

marker_handles.marker_panel=uipanel('Title',['Marker Number ' num2str(myhandles.number_of_markers)],'BackgroundColor',handles.background_color,...
'Units','pixels','position',[0.1*panel_width,height,0.8*panel_width,0.2*handles.gui_height],...
'ForegroundColor',handles.foreground_color,'parent',parent_handle);
uistack(marker_handles.marker_panel,'bottom');
marker_handles.marker_ending_text=uicontrol('Style','Text','String','File ends in',...
'Units','normalized','position',[0.05,0.8,0.2,0.15],'parent',marker_handles.marker_panel,...
'BackgroundColor',handles.background_color,'ForegroundColor',handles.foreground_color,...
'HorizontalAlignment','left');
marker_handles.marker_ending_edit=uicontrol('Style','edit','Units','normalized',...
'position',[0.25,0.8,0.4,0.15],'parent',marker_handles.marker_panel,...
'BackgroundColor',handles.background_color,'ForegroundColor',handles.foreground_color,...
'HorizontalAlignment','left');
marker_handles.marker_color_text=uicontrol('Style','Text','String','Color:',...
'Units','normalized','position',[0.75,0.8,0.1,0.15],'parent',marker_handles.marker_panel,...
'BackgroundColor',handles.background_color,'ForegroundColor',handles.foreground_color,...
'HorizontalAlignment','left');
marker_handles.marker_color_popup=uicontrol('Style','popupmenu','Units','normalized',...
'position',[0.85,0.8,0.125,0.15],'parent',marker_handles.marker_panel,'String',{'-','Red','Green','Blue'},...
'BackgroundColor',handles.background_color,'ForegroundColor',handles.foreground_color,...
'HorizontalAlignment','center');
marker_handles.marker_name_text=uicontrol('Style','Text','String','Name:',...
'Units','normalized','position',[0.05,0.6,0.2,0.15],'parent',marker_handles.marker_panel,...
'BackgroundColor',handles.background_color,'ForegroundColor',handles.foreground_color,...
'HorizontalAlignment','left');

